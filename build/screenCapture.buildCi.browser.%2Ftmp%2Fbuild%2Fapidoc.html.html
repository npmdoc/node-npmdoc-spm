<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="http://spmjs.io">spm (v3.9.0-beta3)</a>
</h1>
<h4>Static Package Manager</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.spm">module spm</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.spm.yuan">
            function <span class="apidocSignatureSpan">spm.</span>yuan
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">spm.</span>client</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">spm.</span>deps</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">spm.</span>module</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">spm.</span>nico</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">spm.</span>run</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">spm.</span>tar</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.spm.client">module spm.client</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.spm.client.config">
            function <span class="apidocSignatureSpan">spm.client.</span>config
            <span class="apidocSignatureSpan">(obj)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.spm.client.info">
            function <span class="apidocSignatureSpan">spm.client.</span>info
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.spm.client.install">
            function <span class="apidocSignatureSpan">spm.client.</span>install
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.spm.client.login">
            function <span class="apidocSignatureSpan">spm.client.</span>login
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.spm.client.publish">
            function <span class="apidocSignatureSpan">spm.client.</span>publish
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.spm.client.search">
            function <span class="apidocSignatureSpan">spm.client.</span>search
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.spm.client.unpublish">
            function <span class="apidocSignatureSpan">spm.client.</span>unpublish
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.spm.deps">module spm.deps</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.spm.deps.getDeps">
            function <span class="apidocSignatureSpan">spm.deps.</span>getDeps
            <span class="apidocSignatureSpan">(file)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.spm.deps.replaceDeps">
            function <span class="apidocSignatureSpan">spm.deps.</span>replaceDeps
            <span class="apidocSignatureSpan">(content, file)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.spm.deps.transform">
            function <span class="apidocSignatureSpan">spm.deps.</span>transform
            <span class="apidocSignatureSpan">(code, file)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.spm.module">module spm.module</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.spm.module.getDependencies">
            function <span class="apidocSignatureSpan">spm.module.</span>getDependencies
            <span class="apidocSignatureSpan">(root)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.spm.module.getSourceFiles">
            function <span class="apidocSignatureSpan">spm.module.</span>getSourceFiles
            <span class="apidocSignatureSpan">(root)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.spm.nico">module spm.nico</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.spm.nico.ignorefilter">
            function <span class="apidocSignatureSpan">spm.nico.</span>ignorefilter
            <span class="apidocSignatureSpan">(filepath, subdir)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">spm.nico.</span>package</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">spm.nico.</span>writers</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">spm.nico.</span>google</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">spm.nico.</span>internalIp</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">spm.nico.</span>output</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">spm.nico.</span>permalink</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">spm.nico.</span>source</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">spm.nico.</span>theme</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">spm.nico.</span>yuanUrl</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.spm.run">module spm.run</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.spm.run.info">
            function <span class="apidocSignatureSpan">spm.run.</span>info
            <span class="apidocSignatureSpan">(name)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.spm.run.record">
            function <span class="apidocSignatureSpan">spm.run.</span>record
            <span class="apidocSignatureSpan">(name, options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.spm.tar">module spm.tar</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.spm.tar.create">
            function <span class="apidocSignatureSpan">spm.tar.</span>create
            <span class="apidocSignatureSpan">(source, target, callback, noIgnore)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.spm.yuan">module spm.yuan</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.spm.yuan.yuan">
            function <span class="apidocSignatureSpan">spm.</span>yuan
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.spm.yuan.Yuan">
            function <span class="apidocSignatureSpan">spm.yuan.</span>Yuan
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.spm" id="apidoc.module.spm">module spm</a></h1>


    <h2>
        <a href="#apidoc.element.spm.yuan" id="apidoc.element.spm.yuan">
        function <span class="apidocSignatureSpan">spm.</span>yuan
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">yuan = function (options) {
  return new Yuan(options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>














</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.spm.client" id="apidoc.module.spm.client">module spm.client</a></h1>


    <h2>
        <a href="#apidoc.element.spm.client.config" id="apidoc.element.spm.client.config">
        function <span class="apidocSignatureSpan">spm.client.</span>config
        <span class="apidocSignatureSpan">(obj)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function config(obj) {
  if (!obj) {
    debug('get %j', _config);
    return _config;
  }
  copy(_config, obj);
  debug('set %j', _config);
  return _config;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
if (exists('package.json')) {
  var pkg = readJSON('package.json');
  var spm = pkg.spm || {};
  registry = spm.registry;
}

// load global config from spmrc
client.<span class="apidocCodeKeywordSpan">config</span>({
  registry: registry || spmrc.get('registry'),
  proxy: spmrc.get('proxy'),
  auth: spmrc.get('auth'),
  temp: spmrc.get('user.temp')
});

exports.config = client.config;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.spm.client.info" id="apidoc.element.spm.client.info">
        function <span class="apidocSignatureSpan">spm.client.</span>info
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function createPromise() {
  return co.call(this, fn.apply(this, arguments));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var log = require('spm-log');
var readJSON = require('fs-extra').readJSONSync;
var yuan = require('./sdk/yuan');
var spmrc = require('spmrc');

module.exports = function upload(options, callback) {
var doc = options.doc || '_site';
log.<span class="apidocCodeKeywordSpan">info</span>('upload', doc);
var pkg = readJSON('package.json');
_createTar(doc, pkg, function(err, target) {
  pkg.tarfile = target;
  pkg.tag = options.tag;
  yuan(options).upload(pkg, function(err, res, body) {
    if (err) {
      log.error('exit', err);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.spm.client.install" id="apidoc.element.spm.client.install">
        function <span class="apidocSignatureSpan">spm.client.</span>install
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function createPromise() {
  return co.call(this, fn.apply(this, arguments));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.spm.client.login" id="apidoc.element.spm.client.login">
        function <span class="apidocSignatureSpan">spm.client.</span>login
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function createPromise() {
  return co.call(this, fn.apply(this, arguments));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.spm.client.publish" id="apidoc.element.spm.client.publish">
        function <span class="apidocSignatureSpan">spm.client.</span>publish
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function createPromise() {
  return co.call(this, fn.apply(this, arguments));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.spm.client.search" id="apidoc.element.spm.client.search">
        function <span class="apidocSignatureSpan">spm.client.</span>search
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function createPromise() {
  return co.call(this, fn.apply(this, arguments));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.spm.client.unpublish" id="apidoc.element.spm.client.unpublish">
        function <span class="apidocSignatureSpan">spm.client.</span>unpublish
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function createPromise() {
  return co.call(this, fn.apply(this, arguments));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.spm.deps" id="apidoc.module.spm.deps">module spm.deps</a></h1>


    <h2>
        <a href="#apidoc.element.spm.deps.getDeps" id="apidoc.element.spm.deps.getDeps">
        function <span class="apidocSignatureSpan">spm.deps.</span>getDeps
        <span class="apidocSignatureSpan">(file)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getDeps = function (file) {
  var content = readFile(file, 'utf-8');
  var extname = path.extname(file);

  var ret = [];
  var re, m;

  // &lt;script type="text/spm"&gt; .... &lt;/script&gt;
  re = /(&lt;script type=\"text\/spm\"&gt;)([\s\S]*?)(&lt;\/script&gt;)/gmi;
  while((m = re.exec(content)) !== null) {
    crequire(m[2]).forEach(function(item) {
      ret.push(normalizeDep(item.path, file));
    });
  }

  // ````javascript .... ````
  if (extname.toLowerCase() === '.md') {
    re = /````(javascript|js)([\s\S]+?)````/gm;
    while ((m = re.exec(content)) !== null) {
      crequire(m[2]).forEach(function (item) {
        ret.push(normalizeDep(item.path, file));
      });
    }
  }

  return require('uniq')(ret);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.spm.deps.replaceDeps" id="apidoc.element.spm.deps.replaceDeps">
        function <span class="apidocSignatureSpan">spm.deps.</span>replaceDeps
        <span class="apidocSignatureSpan">(content, file)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">replaceDeps = function (content, file) {
  if (file) {
    content = readFile(file, 'utf-8');
  } else {
    var file_m = content.match(/&lt;!--filepath:([^\s]+?)\s--&gt;/);
    file = file_m &amp;&amp; file_m[1];
    if (content &amp;&amp; !file) {
      log.error('error', 'filepath not found');
    }
  }

  var extname = path.extname(file);
  var re, re_match;

  // for iframe syntax and html files
  // &lt;script type="text/spm"&gt; .... &lt;/script&gt;
  re = /(&lt;script type=\"text\/spm\"&gt;)([\s\S]*?)(&lt;\/script&gt;)/gi;
  re_match = /(&lt;script type=\"text\/spm\"&gt;)([\s\S]*?)(&lt;\/script&gt;)/i;

  content = content.replace(re, function(replacement) {
    var match = re_match.exec(replacement);
    if (!match) {
      return replacement;
    }
    var code = match[2];
    code = transform(code, file);
    return match[1].replace('type="text/spm"', '') + code + match[3];
  });

  if (extname.toLowerCase() === '.md') {

    // ````javascript ... ````
    re = /(&lt;script class=\"nico-insert-code\"&gt;)([\s\S]*?)(&lt;\/script&gt;)/gi;
    re_match = /(&lt;script class=\"nico-insert-code\"&gt;)([\s\S]*?)(&lt;\/script&gt;)/i;

    content = content.replace(re, function (replacement) {
      var match = re_match.exec(replacement);
      if (!match) {
        return replacement;
      }
      var code = match[2];
      code = transform(code, file);
      var codeMirror =
        '&lt;textarea mode="javascript" class="spm-doc-textarea"&gt;' + match[2] + '&lt;/textarea&gt;';
      return match[1] + code + match[3] + codeMirror;
    });


    // ````css ... ````
    re = /(&lt;style class=\"nico-insert-code\"&gt;)([\s\S]*?)(&lt;\/style&gt;)/gi;
    re_match = /(&lt;style class=\"nico-insert-code\"&gt;)([\s\S]*?)(&lt;\/style&gt;)/i;

    content = content.replace(re, function (replacement) {
      var match = re_match.exec(replacement);
      if (!match) {
        return replacement;
      }
      var codeMirror =
        '&lt;textarea mode="css" class="spm-doc-textarea"&gt;' + match[2] + '&lt;/textarea&gt;';
      return replacement + codeMirror;
    });

  }

  return content;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
find: function(pages, cat) {
  var ret = findCategory(pages, cat);
  if (ret.length) return ret[0];
  return null;
},
find_category: findCategory,
replace_code: function(content) {
  return require('../utils/deps').<span class="apidocCodeKeywordSpan">replaceDeps</span>(content);
},
is_runtime_handlebars: function() {
  var src = findSrc();
  for (var key in src) {
    if (/\.handlebars$/.test(src[key])) {
      return true;
    }
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.spm.deps.transform" id="apidoc.element.spm.deps.transform">
        function <span class="apidocSignatureSpan">spm.deps.</span>transform
        <span class="apidocSignatureSpan">(code, file)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function transform(code, file) {
  // è½¬æ¢ jsx ä»£ç&nbsp;
  if (code.indexOf('/** @jsx React.DOM */') &gt; -1) {
    code = ReactTools.transform(code);
  }

  // ä¾èµ–è½¬æ¢
  code = crequire(code, function(item) {
    return 'window[\'' + normalizeDep(item.path, file) + '\']';
  });

  return code;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
};

exports.transform = transform;

function transform(code, file) {
// è½¬æ¢ jsx ä»£ç&nbsp;
if (code.indexOf('/** @jsx React.DOM */') &gt; -1) {
  code = ReactTools.<span class="apidocCodeKeywordSpan">transform</span>(code);
}

// ä¾èµ–è½¬æ¢
code = crequire(code, function(item) {
  return 'window[\'' + normalizeDep(item.path, file) + '\']';
});
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.spm.module" id="apidoc.module.spm.module">module spm.module</a></h1>


    <h2>
        <a href="#apidoc.element.spm.module.getDependencies" id="apidoc.element.spm.module.getDependencies">
        function <span class="apidocSignatureSpan">spm.module.</span>getDependencies
        <span class="apidocSignatureSpan">(root)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getDependencies = function (root) {
  var pkg = new Package(root || process.cwd(), {
    moduleDir: spmrc.get('install.path')
  });

  var ret = {};
  var deps = extend({}, pkg.dependencies, pkg.devDependencies);
  for (var k in deps) {
    if (!deps.hasOwnProperty(k)) continue;
    var dep = deps[k];
    ret[dep.name] = dep.name + '/' + dep.version + '/' + dep.main;
  }
  return ret;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.spm.module.getSourceFiles" id="apidoc.element.spm.module.getSourceFiles">
        function <span class="apidocSignatureSpan">spm.module.</span>getSourceFiles
        <span class="apidocSignatureSpan">(root)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getSourceFiles = function (root) {
  var pkg = new Package(root || process.cwd(), {
    moduleDir: spmrc.get('install.path')
  });
  return Object.keys(pkg.files).map(function(file) {
    return file.replace(/\.js$/, '');
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.spm.nico" id="apidoc.module.spm.nico">module spm.nico</a></h1>


    <h2>
        <a href="#apidoc.element.spm.nico.ignorefilter" id="apidoc.element.spm.nico.ignorefilter">
        function <span class="apidocSignatureSpan">spm.nico.</span>ignorefilter
        <span class="apidocSignatureSpan">(filepath, subdir)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">ignorefilter = function (filepath, subdir) {
  var extname = path.extname(filepath);
  var filename = path.basename(filepath);
  // dotfiles
  if (extname === '' &amp;&amp; filename.indexOf('.') === 0) {
    return false;
  }
  if (extname === '.tmp' || extname === '.bak') {
    return false;
  }
  // html éœ€é¢å¤–å¤„ç†ï¼Œä¸èƒ½åšç®€å•å¤åˆ¶
  if (extname === '.html') {
    return false;
  }
  if (/\.DS_Store/.test(filepath)) {
    return false;
  }
  if (new RegExp('^' + spmrc.get('install.path')).test(subdir) &amp;&amp;
      /\.(md|markdown|html|psd|zip|yml)/.test(path.extname(filepath))) {
    return false;
  }
  if (/^(_site|_theme|node_modules|spm_modules|\.idea)/.test(subdir)) {
    return false;
  }
  return true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>




















</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.spm.run" id="apidoc.module.spm.run">module spm.run</a></h1>


    <h2>
        <a href="#apidoc.element.spm.run.info" id="apidoc.element.spm.run.info">
        function <span class="apidocSignatureSpan">spm.run.</span>info
        <span class="apidocSignatureSpan">(name)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function info(name) {
  var data = {};
  if (exists(runfile)) {
    data = readJSON(runfile);
  }
  if (!name) {
    return data || {};
  }
  return data[name] || {};
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var log = require('spm-log');
var readJSON = require('fs-extra').readJSONSync;
var yuan = require('./sdk/yuan');
var spmrc = require('spmrc');

module.exports = function upload(options, callback) {
var doc = options.doc || '_site';
log.<span class="apidocCodeKeywordSpan">info</span>('upload', doc);
var pkg = readJSON('package.json');
_createTar(doc, pkg, function(err, target) {
  pkg.tarfile = target;
  pkg.tag = options.tag;
  yuan(options).upload(pkg, function(err, res, body) {
    if (err) {
      log.error('exit', err);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.spm.run.record" id="apidoc.element.spm.run.record">
        function <span class="apidocSignatureSpan">spm.run.</span>record
        <span class="apidocSignatureSpan">(name, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function record(name, options) {
  var data = info();
  var ret = data[name] || {};

  if (options) {
    Object.keys(options).forEach(function(key) {
      ret[key] = options[key];
    });
  }

  ret.name = name;
  if (ret.count) {
    ret.count += 1;
  } else {
    ret.count = 1;
  }
  ret.time = new Date();
  data[name] = ret;
  mkdirs(dirname(runfile));
  writeJSON(runfile, data);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.spm.tar" id="apidoc.module.spm.tar">module spm.tar</a></h1>


    <h2>
        <a href="#apidoc.element.spm.tar.create" id="apidoc.element.spm.tar.create">
        function <span class="apidocSignatureSpan">spm.tar.</span>create
        <span class="apidocSignatureSpan">(source, target, callback, noIgnore)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">create = function (source, target, callback, noIgnore) {
  function returnError(err) {
    // don't call the callback multiple times, just return the first error
    var _callback = callback;
    callback = function() {};
    return _callback(err);
  }

  var fwriter = fstream.Writer({ type: 'File', path: target });
  fwriter.on('error', function(err) {
    log.error('writing', target);
    return returnError(err);
  });

  fwriter.on('close', function() {
    callback(null, target);
  });

  var pkg = JSON.parse(fs.readFileSync(path.join(source, 'package.json')));
  var ignoreArray;
  if (pkg &amp;&amp; pkg.spm &amp;&amp; pkg.spm.ignore) {
    ignoreArray = pkg.spm.ignore;
  } else {
    ignoreArray = [];
  }
  var ignoreFiles = ['.gitignore', '.spmignore'];

  if (noIgnore) {
    ignoreFiles = [];
    ignoreArray = []; // always ignore dist when noIgnore
  }

  var istream = new Packer({
    path: source,
    type: 'Directory',
    ignoreFiles: ignoreFiles,
    ignoreArray: ignoreArray,
    isDirectory: true
  });
  istream.on('error', function(err) {
    log.error('reading', source);
    return returnError(err);
  });

  var packer = tar.Pack({ noProprietary: true });
  packer.on('error', function(err) {
    log.error('creating', target);
    return returnError(err);
  });

  var zipper = zlib.Gzip();
  zipper.on('error', function(err) {
    log.error('gzip', target);
    return returnError(err);
  });

  istream.pipe(packer).pipe(zipper).pipe(fwriter);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}, true);
};

function _createTar(directory, data, callback, noIgnore) {
var name = format('%s-%s.tar.gz', data.name, data.version || '');
var tmp = spmrc.get('user.temp');
var tarfile = path.join(tmp, name);
tar.<span class="apidocCodeKeywordSpan">create</span>(directory, tarfile, function(error, target) {
  var size = fs.statSync(target).size;
  log.info('tarfile', name + ' - ' + ((size/1024).toFixed(2) + 'KB').to.magenta);
  // 2 MB
  if (size &gt; 2079152) {
    log.warn('size', 'package is a little big, maybe you need a .spmignore');
  }
  if (error) {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.spm.yuan" id="apidoc.module.spm.yuan">module spm.yuan</a></h1>


    <h2>
        <a href="#apidoc.element.spm.yuan.yuan" id="apidoc.element.spm.yuan.yuan">
        function <span class="apidocSignatureSpan">spm.</span>yuan
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">yuan = function (options) {
  return new Yuan(options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.spm.yuan.Yuan" id="apidoc.element.spm.yuan.Yuan">
        function <span class="apidocSignatureSpan">spm.yuan.</span>Yuan
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Yuan(options) {
  options = options || {};

  this.server = options.registry || spmrc.get('registry') || 'http://spmjs.io';
  this.server = this.server.replace(/\/$/, '');
  options.proxy = options.proxy || spmrc.get('proxy');

  this.authKey = 'auth';
  this.options = options;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>